export default {
  async fetch(request, env) {
    const corsHeaders = {
      "Access-Control-Allow-Origin": "*",
      "Access-Control-Allow-Methods": "GET, POST, OPTIONS",
      "Access-Control-Allow-Headers": "Content-Type",
    };

    if (request.method === "OPTIONS") return new Response(null, { headers: corsHeaders });

    try {
      const url = new URL(request.url);
      
      // Ambil data Admin (Logika yang Anda buktikan berhasil)
      if (url.pathname === "/api/admin") {
        const { results } = await env.DB.prepare("SELECT user, pwd, role FROM admin").all();
        return new Response(JSON.stringify(results), {
          headers: { ...corsHeaders, "Content-Type": "application/json" }
        });
      }

      // Ambil data Buku
      if (url.pathname === "/api/buku") {
        const { results } = await env.DB.prepare("SELECT * FROM buku").all();
        return new Response(JSON.stringify(results), {
          headers: { ...corsHeaders, "Content-Type": "application/json" }
        });
      }

      // Ambil data Anggota
      if (url.pathname === "/api/anggota") {
        const { results } = await env.DB.prepare("SELECT * FROM anggota").all();
        return new Response(JSON.stringify(results), {
          headers: { ...corsHeaders, "Content-Type": "application/json" }
        });
      }

      return new Response("Not Found", { status: 404, headers: corsHeaders });
    } catch (e) {
      return new Response(e.message, { status: 500, headers: corsHeaders });
    }
  }
};
