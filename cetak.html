// Gunakan URL lengkap tanpa ada simbol aneh
const API = "https://admin-perpus.donnyn1980.workers.dev";

async function auth() {
    const userIn = document.getElementById('userInput').value;
    const pwdIn = document.getElementById('pwdInput').value;

    console.log("Mencoba menghubungkan ke:", `${API}/api/admin`);

    try {
        const res = await fetch(`${API}/api/admin`, {
            method: 'GET', // Menggunakan GET agar sama persis dengan kode tes Anda yang sukses
            mode: 'cors'
        });

        if (!res.ok) throw new Error("Server merespon dengan error");
        
        const admins = await res.json();
        const found = admins.find(a => a.user === userIn && a.pwd === pwdIn);

        if (found) {
            document.getElementById('login-section').classList.add('hidden');
            document.getElementById('main-dashboard').classList.remove('hidden');
            loadBuku(); 
            loadAnggota();
        } else {
            Swal.fire('Gagal', 'User atau Password Salah', 'error');
        }
    } catch (err) {
        console.error("Detail Error:", err);
        Swal.fire('Koneksi Gagal', 'Browser menolak akses. Coba buka di Tab Penyamaran (Incognito).', 'error');
    }
}
